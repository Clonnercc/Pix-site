<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Pagamento Pix</title>

<style>
body{margin:0;font-family:system-ui;background:#f2f2f2}
.screen{min-height:100vh;display:flex;flex-direction:column}
.top{background:#2db36c;color:#fff;padding:30px 20px;text-align:center}
.icon{width:80px;height:80px;border-radius:50%;background:#fff;margin:0 auto 15px;display:grid;place-items:center;color:#2db36c;font-size:36px}
.content{padding:20px}
.card{background:#fff;border-radius:12px;padding:20px;box-shadow:0 10px 25px rgba(0,0,0,.08)}
.label{color:#666;font-size:14px;margin-bottom:5px}
.value{font-size:18px;font-weight:700;margin-bottom:10px}
.code{background:#f4f4f4;padding:10px;border-radius:6px;font-size:12px;word-break:break-all}
.btn{margin-top:15px;width:100%;padding:12px;border:0;border-radius:8px;font-size:16px;cursor:pointer}
.primary{background:#1c9bd6;color:#fff}

/* Modal */
.modal{position:fixed;inset:0;background:rgba(0,0,0,.45);display:none;place-items:center;z-index:10}
.modal .box{background:#fff;border-radius:12px;padding:20px;max-width:320px}
.modal h3{text-align:center;margin-top:0}
.modal ul{padding-left:18px;font-size:14px}
.modal li{margin-bottom:6px}
</style>
</head>

<body>

<div class="screen">
  <div class="top">
    <div class="icon">üõçÔ∏è</div>
    <h2 id="titulo">Carregando...</h2>
    <p id="subtitulo"></p>
  </div>

  <div class="content">
    <div class="card">
      <div class="label">Valor do Pix:</div>
      <div class="value" id="valor"></div>

      <div class="label">C√≥digo Pix (Copia e Cola):</div>
      <div class="code" id="codigo"></div>

      <button class="btn primary" onclick="copiar()">Copiar c√≥digo</button>
      <p id="validade" style="font-size:12px;color:#777;margin-top:8px"></p>
    </div>
  </div>
</div>

<!-- MODAL INSTRU√á√ïES -->
<div class="modal" id="modal">
  <div class="box">
    <h3>C√≥digo copiado com sucesso</h3>
    <p style="font-size:14px">Agora siga os passos abaixo:</p>
    <ul>
      <li>Abra o aplicativo do seu banco</li>
      <li>Toque em <strong>Pix</strong></li>
      <li>Escolha <strong>Pix Copia e Cola</strong></li>
      <li>Cole o c√≥digo copiado</li>
      <li>Confira o valor e confirme o pagamento</li>
    </ul>
    <button class="btn primary" onclick="fechar()">Entendi</button>
  </div>
</div>

<script>
/* ================= CONFIG ================= */
const API = 'https://pix-site-api.onrender.com/api/pix';

/* ================= ADMIN URL ================= */
(function(){
  const params = new URLSearchParams(window.location.search);
  if(params.has('adminhkchef')){
    window.location.href = '/adminhkchef.html';
  }
})();

/* ================= ESTADO ================= */
let PIX_CODE = '';
let estadoAtual = '';

/* ================= CARREGAR / ATUALIZAR ================= */
async function carregarDados(){
  try{
    const res = await fetch(API, { cache:'no-store' });
    const d = await res.json();

    const novoEstado = JSON.stringify(d);
    if(novoEstado === estadoAtual) return;

    estadoAtual = novoEstado;

    document.getElementById('titulo').innerText = d.titulo || '';
    document.getElementById('subtitulo').innerText = d.subtitulo || '';
    document.getElementById('valor').innerText = d.valor || '';
    document.getElementById('codigo').innerText = d.codigo || '';
    document.getElementById('validade').innerText = d.validade || '';

    PIX_CODE = d.codigo || '';
  }catch(e){
    console.error('Erro ao buscar dados da API');
  }
}

/* primeira carga */
carregarDados();

/* atualiza√ß√£o cont√≠nua (tempo real pr√°tico) */
setInterval(carregarDados, 5000);

/* ================= INTERA√á√ïES ================= */
function copiar(){
  if(!PIX_CODE) return;
  navigator.clipboard.writeText(PIX_CODE).then(()=>{
    document.getElementById('modal').style.display = 'grid';
  });
}

function fechar(){
  document.getElementById('modal').style.display = 'none';
}
</script>

</body>
</html>
